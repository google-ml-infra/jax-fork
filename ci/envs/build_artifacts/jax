# Inherit default JAXCI environment variables.
source ci/envs/default

# Build JAX artifact.
export JAXCI_BUILD_JAX_ENABLE="1"

os=$(uname -s | awk '{print tolower($0)}')
arch=$(uname -m)

# Linux x86 specifc settings
if [[ $os == "linux" ]] && [[ $arch == "x86_64" ]]; then
  # Note Python version of the container does not matter. JAX supports hermetic
  # Python and thus the actual Python version of the artifact is controlled by
  # the value set in `HERMETIC_PYTHON_VERSION`
  export JAXCI_DOCKER_IMAGE="us-central1-docker.pkg.dev/tensorflow-sigs/tensorflow/build:670606426-python3.9"
fi

# Linux Aarch64 specifc settings
if [[ $os == "linux" ]] && [[ $arch == "aarch64" ]]; then
  export JAXCI_DOCKER_IMAGE="us-central1-docker.pkg.dev/tensorflow-sigs/tensorflow/build-arm64:jax-"
fi

# Windows specific settings
if [[ $os =~ "msys_nt" ]]; then
  export JAXCI_DOCKER_IMAGE="gcr.io/tensorflow-testing/tf-win2019-rbe@sha256:1082ef4299a72e44a84388f192ecefc81ec9091c146f507bc36070c089c0edcc"

  # While we run these scripts in Cygwin on Windows,
  # the path needs to be in Windows format.
  export JAXCI_JAX_GIT_DIR=$(cygpath -w $JAXCI_JAX_GIT_DIR)
  export JAXCI_OUTPUT_DIR=$(cygpath -w $JAXCI_JAX_GIT_DIR)
  export JAXCI_DOCKER_WORK_DIR=$(cygpath -w /c/jax/)
fi